---
title: "Oefeningen week 5"
output: html_notebook
author: "Jelle Becirspahic, Micha Beens, Niek Scholten"
---

###Opdracht 1  
*Download de meest recente lijst met aardbevingen en geef de 5 plaatsen met de zwaarste aardbevingen.*

```{r}
all_induced <- read.csv("all_induced.csv")
highest_values <- order(all_induced$MAG, decreasing = T)[1:5]

all_induced$LOCATION[highest_values]
```

###Opdracht 2
*In welke tien plaatsen hebben zich de meeste opgewekte aardbevingen voorgedaan met een sterkte van meer dan 1.5?*

```{r}
waarde <- order(all_induced$MAG, decreasing = T)[sort(all_induced$MAG, decreasing = T) > 1.5]

names(sort(table(all_induced$LOCATION[waarde]), decreasing = T)[1:10])

```

###Opdracht 3
*Is er in de gemeente Loppersum een trend in de frequentie van het optreden van aardbevingen zichtbaar?*

```{r}
indices <- which(all_induced$LOCATION == "Loppersum")
date <- all_induced$YYMMDD[indices]

hist(floor(date/10000), 
     breaks = 35,
     main = "Hoeveelheid aarbevingen over tijd",
     xlab = "Tijd [jaar]",
     ylab = "Aantal [-]"
     )

```

###Opdracht 4
*De dataset bevat regels met metingen aan verschillende soorten irissen. Gemeten zijn de lengte en de breedte van de kelk- en de bloemblaadjes. Welke van deze gegevens kun je gebruiken om een iris die je in de tuin hebt te determineren? Maak een figuur c.q. de figuren die je hiervoor nodig hebt.*

```{r}
summary(iris)

plot(iris$Species, iris$Sepal.Length, 
     main="Sepal Length per species", 
     ylab="Sepal length [cm]", 
     xlab = "Species")

plot(iris$Species, iris$Sepal.Width, 
     main="Sepal Width per species", 
     ylab="Sepal Width [cm]", 
     xlab = "Species")

plot(iris$Species, iris$Petal.Length, 
     main="Petal Length per species", 
     ylab="Petal length [cm]", 
     xlab = "Species")

plot(iris$Species, iris$Petal.Width, 
     main="Petal Width per species", 
     ylab="Petal Width [cm]", 
     xlab = "Species")
```
Bij de blad lengte is het grootste verschil te zien tussen de verschillende soorten. Hier zou dus het makkelijkst onderscheid in te maken zijn.

###Opdracht 5
*Geef in een codeblok de R-code waarmee je een .xls in kunt lezen in R*

```{r}
library("readxl")
my.data <- read_excel("Historical Data Export-20190228192905.xls")
```

###Opdracht 6
*Je kunt een .xls ook converteren naar het .csv formaat. Leg uit (code en tekst) hoe je dit m.b.v. Python doet.*

```{python}
import xlrd
import csv

def csv_from_excel():
  wb = xlrd.open_workbook('your_workbook.xls')
  sh = wb.sheet_by_name('Sheet1')
  your_csv_file = open('your_csv_file.csv', 'wb')
  wr = csv.writer(your_csv_file, quoting=csv.QUOTE_ALL)
  
  for rownum in xrange(sh.nrows):
      wr.writerow(sh.row_values(rownum))

  your_csv_file.close()
```

###Opdracht 7
*Je kunt een .xls ook converteren naar het .csv formaat. Leg uit (code) hoe je dit m.b.v. LibreOffice kunt doen.*

libreoffice --headless --convert-to csv "my_file.xls"

###Opdracht 8
*Pas het commando uit opdracht 7 zo aan dat je alle .xls bestanden in één directory tegelijk converteert.*

libreoffice --headless --convert-to csv *.xls

###Opdracht 9
*In /homes/arne/tmp/data/ staan een aantal .xls bestanden die gegevens over een batterij zonnecellen bevatten. I staat voor stroomsterkte in Ampere V staat voor spanning in Volt F staat voor de (wisselstroom)frequentie in Herz. Pac staat voor het op dat moment afgegeven vermogen in Watt. pv staat voor ‘photo voltaic’ dus opgewekt door de zonnecellen. Er zijn hier twee groepen voor. ac staat voor ‘alternating current’ dus dit wordt doorgegeven aan het stroomnetwerk. Hiervoor zijn er 3 fasen. De overige velden zouden voor zich moeten spreken.* 
*Copiëer deze data naar een directory in je eigen home en lees ze in in R.*

```{r}
read_xls.self <- function(x){
  read_xls(x, col_names = T, skip = 2)
}
my.data <- lapply(Sys.glob("*.xls"), read_xls.self)
```

###Opdracht 10
*Gebruik de gegevens die je in opdracht 9 ingelezen hebt. Maak één figuur waarin je het totaal aantal KWh wat gegenereerd is uitzet tegen de tijd (datum). Gebruik hiervoor de gegevens uit alle bestanden. Laat de datum zien in het formaat yyyymmdd.*

```{r}
# Genereer de lege variabelen
tijd <- character(0)
gegenereerd <- numeric(0)
dagelijks_gegenereerd <- numeric(0)

# Loop door alle lijsten in de grote lijst
for(num in 1:length(my.data)){
  
  # Zet alle variabelen van de kolom Time in de tijd vector
  tijd <- c(tijd, my.data[[num]]$Time)
  
  # Zet alle variabelen van de kolom Total Generation(kWh) in de gegenereerd vector
  gegenereerd <- c(gegenereerd, my.data[[num]]$`Total Generation(kWh)`)
  
  dagelijks_gegenereerd <- c(dagelijks_gegenereerd, my.data[[num]]$`Daily Generation(kWh)`)
  
  # Verwijder alle variabelen die in de loop zijn aangemaakt
  rm(num)
}

# Verander de tijd vector van character class naar de Date class
tijd <- as.Date(tijd, format = "%m/%d/%Y")

# Plot de tijd tegen het totaal gegenereerde energie
plot(tijd, gegenereerd, 
     type = "h", # h = histogram
     main = "Overzicht totale energie gegenereerd",
     xlab = "Tijd [dagen]",
     ylab = "Totaal gegenereerd [kWh]")
```

###Opdracht 11 
*Gebruik de gegevens die je in opdracht 9 ingelezen hebt. Maak een figuur waarin je de gemiddelde dagopbrengst per maand laat zien.*

```{r}
# maak de variabelen aan die worden gebruikt
maanden <- unique(months.Date(tijd))
gem_dagelijks_gegenereerd <- numeric(0)

# Loop door alle maanden heen
for(maand in maanden){
  # Voeg het dagelijks gemiddelde van de maand toe aan de vector
  gem_dagelijks_gegenereerd <- c(gem_dagelijks_gegenereerd, mean(dagelijks_gegenereerd[months.Date(tijd) == maand]))
  rm(maand)
}

# Geef het dagelijks gemiddelde van de maand de naam van de maand
names(gem_dagelijks_gegenereerd) <- maanden

# Plot de grafiek
barplot(gem_dagelijks_gegenereerd,
        xlab = "Tijd [maanden]",
        ylab = "Gem opbrengst [kWh]")

#of

# maak de variabelen aan die worden gebruikt
dagen <- unique(tijd)
gem_dagelijks_gegenereerd <- numeric(0)

# Loop door alle maanden heen
for(dag in dagen){
  # Voeg het dagelijks gemiddelde van de maand toe aan de vector
  gem_dagelijks_gegenereerd <- c(gem_dagelijks_gegenereerd, mean(dagelijks_gegenereerd[tijd == dag]))
  rm(dag)
}

# Geef het dagelijks gemiddelde van de maand de naam van de maand
names(gem_dagelijks_gegenereerd) <- dagen

# Plot de grafiek
barplot(gem_dagelijks_gegenereerd,
        xlab = "Tijd [dagen]",
        ylab = "Gem opbrengst [kWh]")
```


###Opdracht 12 
*Beschrijf (in tekst dus) hoe je uit de gegevens die je in opdracht 9 ingelezen hebt af zou kunnen leiden hoe het dak waar de zonnecellen op liggen geörienteerd is (dus oost, zuid, zuidwest . . . ). De timestamps zijn zijn altijd zomertijd (ook ‘s winters dus). Maak een figuur waarin je dit af kunt lezen. Houd er rekening mee dat de kracht van de zon niet constant is gedurende het jaar. Je zult dus de gegevens op de een of de andere manier moeten ’normaliseren’. Hint: bij statistiek normaliseer je ook als je data vergelijkt met scores van standaardverdelingen.*

```{r}
# Naar mijn verwachtingen is de zonepaneel georienteerd richting het zuiden. Dit is mijn verwachting aangezien er in de ochtend en avond het miste energie wordt gecreerd en in de middag bijna alles.
daily_gen <- my.data[[1]]$`Daily Generation(kWh)`
tijd.min <- substr(my.data[[1]]$Time, 12, 19)
tijd.min.order <- order(tijd.min)
names(daily_gen) <- tijd.min
barplot(daily_gen[tijd.min.order])
```



